#!/bin/bash

apt install build-essential libncurses5-dev fakeroot
apt install linux-source-4.9
# Reading package lists... Done
# Building dependency tree
# Reading state information... Done
# The following additional   packages will be installed:
#  bc libreadline7
# Suggested packages:
#  libncurses-dev | ncurses-dev libqt4-dev
# The following NEW packages will be installed:
#  bc libreadline7 linux-source-4.9
# 0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.
# Need to get 95.4 MB of archives.
# After this operation, 95.8 MB of additional disk space will be used.
# Do you want to continue? [Y/n] y
# [...]

ls /usr/src
# linux-config-4.9 linux-patch-4.9-rt.patch.xz linux-source-4.9.tar.xz

mkdir ~/kernel; cd ~/kernel
tar -xaf /usr/src/linux-source-4.9.tar.xz

cp /boot/config-4.9.0-kali1-amd64 ~/kernel/linux-source-4.9/.config

make deb-pkg LOCALVERSION=-custom KDEB_PKGVERSION=$(make kernelversion)-1
# [...]

ls ../*.deb
# ../linux-headers-4.9.0-kali1-custom_4.9.2-1_amd64.deb
# ../linux-image-4.9.0-kali1-custom_4.9.2-1_amd64.deb
# ../linux-image-4.9.0-kali1-custom-dbg_4.9.2-1_amd64.deb
# ../linux-libc-dev_4.9.2-1_amd64.deb

apt install curl git live-build
# [...]

git clone git://git.kali.org/live-build-config.git
# [...]

cd live-build-config
ls
auto build_all.sh build.sh kali-config README

./build.sh --variant kde --verbose
